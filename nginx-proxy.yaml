kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: nginx-spa-proxy
spec:
  to:
    kind: Service
    name: nginx-spa-proxy
    weight: 100
  port:
    targetPort: 8080
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  wildcardPolicy: None
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-spa-proxy
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
---      
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-spa-proxy
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx-spa-proxy
        image: nginxinc/nginx-unprivileged:1.25
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8081          
      volumes:
        - name: nginx-config
          configMap:
            # Provide the name of the ConfigMap containing the files you want
            # to add to the container
            name: special-config        
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  nginx.conf: |
    pid /tmp/nginx.pid;
    worker_processes  5;
    worker_rlimit_nofile 8192;

    events {
      worker_connections  4096;  ## Default: 1024
    }


    http {
        server {
            listen                  8081;
            auth_basic              off;
            location /healthz {
                return 200;
            }
        }

        server {
            proxy_set_header Custom-Header Value;
            listen 8080;
            location / {
                proxy_pass http://192.168.86.32:8081;
            }
        }
    }        